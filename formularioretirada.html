<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Retirada de Equipamentos</title>
    <!-- Adicionando jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #4a6bff;
            --primary-hover: #3a56d4;
            --background: #121212;
            --surface: #1e1e1e;
            --surface-light: #2a2a2a;
            --text: #e0e0e0;
            --text-secondary: #b0b0b0;
            --error: #ff4a4a;
            --success: #4caf50;
        }
        
        body {
            font-family: 'Segoe UI', Roboto, -apple-system, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: var(--text);
            background-color: var(--background);
        }
        
        /* (Mantenha todos os outros estilos CSS como estão no seu código original) */
        /* ... */
        
    </style>
</head>
<body>
    <!-- Mantenha todo o HTML do formulário como está -->
    <!-- ... -->

    <script>
        // Inicializar jsPDF
        const { jsPDF } = window.jspdf;
        
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('retiradaForm');
            const submitBtn = document.getElementById('submitBtn');
            const thankYou = document.getElementById('thankYou');
            
            // Configurar data atual como padrão
            const dataInput = document.getElementById('dataRetirada');
            const today = new Date().toISOString().split('T')[0];
            dataInput.value = today;
            
            // Mostrar campos condicionais
            document.getElementById('motivo8').addEventListener('change', function() {
                document.getElementById('outrosMotivo').style.display = this.checked ? 'block' : 'none';
                if (!this.checked) document.getElementById('outrosMotivoText').value = '';
            });
            
            document.getElementById('troca1').addEventListener('change', function() {
                document.getElementById('nomeProvedorGroup').style.display = this.checked ? 'block' : 'none';
                if (!this.checked) document.getElementById('nomeProvedor').value = '';
            });
            
            // Validação em tempo real
            form.addEventListener('input', function(e) {
                const input = e.target;
                if (input.required && !input.value) {
                    input.style.borderColor = 'var(--error)';
                } else {
                    input.style.borderColor = '#333';
                }
            });
            
            // Função para gerar PDF
            function gerarPDF(formData) {
                const doc = new jsPDF();
                
                // Cabeçalho
                doc.setFontSize(18);
                doc.setTextColor(74, 107, 255);
                doc.text('FORMULÁRIO DE RETIRADA DE EQUIPAMENTOS', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                // Informações do cliente
                doc.text(`ID do Cliente: ${formData.clienteId}`, 20, 40);
                doc.text(`Data: ${new Date(formData.dataRetirada).toLocaleDateString('pt-BR')}`, 20, 50);
                
                // Dados do formulário
                let yPos = 70;
                
                doc.setFontSize(14);
                doc.text('DADOS DO FORMULÁRIO', 20, yPos);
                yPos += 10;
                
                doc.setFontSize(12);
                doc.text(`1. Motivo do cancelamento: ${formData.motivo}${formData.outrosMotivo ? ' (' + formData.outrosMotivo + ')' : ''}`, 20, yPos);
                yPos += 10;
                
                doc.text(`2. Mudança de endereço/cidade: ${formData.mudanca}`, 20, yPos);
                yPos += 10;
                
                if (formData.troca === 'Sim') {
                    doc.text(`3. Troca de provedor: Sim - ${formData.nomeProvedor}`, 20, yPos);
                } else {
                    doc.text(`3. Troca de provedor: ${formData.troca}`, 20, yPos);
                }
                yPos += 10;
                
                doc.text(`4. Expectativas: ${formData.expectativa}`, 20, yPos);
                yPos += 10;
                
                doc.text(`5. Dificuldades: ${formData.dificuldade}`, 20, yPos);
                yPos += 10;
                
                if (formData.observacoes) {
                    const splitObservacoes = doc.splitTextToSize(`Observações: ${formData.observacoes}`, 170);
                    doc.text(splitObservacoes, 20, yPos);
                    yPos += 10 * splitObservacoes.length;
                }
                
                doc.text(`Atendente: ${formData.atendente}`, 20, yPos);
                yPos += 20;
                
                // Assinaturas
                doc.line(20, yPos, 90, yPos);
                doc.text('Assinatura do Cliente', 55, yPos + 10, { align: 'center' });
                
                doc.line(120, yPos, 190, yPos);
                doc.text('Assinatura do Atendente', 155, yPos + 10, { align: 'center' });
                
                // Rodapé
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Documento gerado em ${new Date().toLocaleString('pt-BR')}`, 105, 285, { align: 'center' });
                
                return doc;
            }
            
            // Envio do formulário
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validar campos obrigatórios
                let isValid = true;
                const requiredInputs = form.querySelectorAll('[required]');
                
                requiredInputs.forEach(input => {
                    if (!input.value) {
                        input.style.borderColor = 'var(--error)';
                        isValid = false;
                    }
                });
                
                if (!isValid) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }
                
                // Desativar botão durante o envio
                submitBtn.disabled = true;
                submitBtn.textContent = 'Gerando PDF...';
                submitBtn.style.opacity = '0.7';
                
                try {
                    // Coletar todos os dados do formulário
                    const formData = {
                        clienteId: document.getElementById('clienteId').value,
                        dataRetirada: document.getElementById('dataRetirada').value,
                        motivo: document.querySelector('input[name="motivo"]:checked')?.value,
                        outrosMotivo: document.getElementById('outrosMotivoText').value,
                        mudanca: document.querySelector('input[name="mudanca"]:checked')?.value,
                        troca: document.querySelector('input[name="troca"]:checked')?.value,
                        nomeProvedor: document.getElementById('nomeProvedor').value,
                        expectativa: document.querySelector('input[name="expectativa"]:checked')?.value,
                        dificuldade: document.querySelector('input[name="dificuldade"]:checked')?.value,
                        observacoes: document.getElementById('observacoes').value,
                        atendente: document.getElementById('atendente').value
                    };
                    
                    // Gerar PDF
                    const pdf = gerarPDF(formData);
                    
                    // Salvar PDF
                    pdf.save(`Retirada_Equipamentos_${formData.clienteId}_${new Date().toISOString().split('T')[0]}.pdf`);
                    
                    // Mostrar mensagem de sucesso
                    form.style.display = 'none';
                    thankYou.style.display = 'block';
                    thankYou.scrollIntoView({ behavior: 'smooth' });
                    
                    // Resetar o formulário após 5 segundos
                    setTimeout(() => {
                        form.reset();
                        dataInput.value = today;
                        form.style.display = 'block';
                        thankYou.style.display = 'none';
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Enviar Formulário';
                        submitBtn.style.opacity = '1';
                    }, 5000);
                    
                } catch (error) {
                    console.error('Erro ao gerar PDF:', error);
                    alert('Ocorreu um erro ao gerar o PDF. Por favor, tente novamente.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Enviar Formulário';
                    submitBtn.style.opacity = '1';
                }
            });
        });
    </script>
</body>
</html>
